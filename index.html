<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Policy Task List — UI Enhancements Demo</title>
  <style>
    :root {
      --bg: #f6f7f8;
      --panel: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --accent: #0ea5e9; /* sky-500 */
      --danger: #ef4444; /* red-500 */
      --success: #22c55e; /* green-500 */
      --warning: #f59e0b; /* amber-500 */
      --radius: 14px;
      --shadow: 0 6px 18px rgba(17, 24, 39, 0.08);
      --sticky-shadow: 0 10px 20px rgba(0,0,0,.06);
      --icon-size: 22px;           /* ↑ larger button icon size */
      --icon-size-lg: 24px;        /* task list icon size */
      --btn-padding: 8px 12px;
    }

    html, body {
      margin: 0; padding: 0; background: var(--bg); color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
    }

    .container { max-width: 980px; margin: 24px auto; padding: 0 16px; }

    /* Header: now sticky so it follows the user while scrolling */
    .tasklist-header {
      position: sticky; top: 0; z-index: 20;
      background: var(--panel);
      margin: 0 -16px 18px; /* extend edge-to-edge while keeping body padded */
      padding: 18px 16px;
      border-bottom: 1px solid #e5e7eb;
      box-shadow: var(--sticky-shadow);
    }

    h1 { font-size: 28px; margin: 0 0 6px; }
    .subhead { color: var(--muted); margin: 6px 0 14px; }

    .controls { display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    select, button, input[type="text"] {
      border-radius: 12px; border: 1px solid #e5e7eb; background: #fff; color: var(--text);
      padding: 10px 12px; font-size: 14px;
    }

    .btn { cursor: pointer; padding: var(--btn-padding); border: 1px solid #e5e7eb; background: #fff; border-radius: 999px; display: inline-flex; align-items: center; gap: 8px; transition: transform .05s ease, box-shadow .2s ease; }
    .btn:hover { box-shadow: 0 4px 14px rgba(0,0,0,.08); }
    .btn:active { transform: translateY(1px); }
    .btn-primary { background: var(--accent); border-color: var(--accent); color: #fff; }
    .btn-ghost { background: #fff; }
    .btn-danger { background: #fff; border-color: #fecaca; }

    .btn .icon { width: var(--icon-size-lg); height: var(--icon-size-lg); display: inline-block; }

    /* Cards */
    .panel { background: var(--panel); border-radius: var(--radius); box-shadow: var(--shadow); padding: 16px; }

    .stack { display: grid; gap: 12px; }

    /* Task rows */
    .row { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; padding: 12px 10px; border: 1px solid #e5e7eb; border-radius: 12px; }
    .row[aria-disabled="true"] { opacity: .5; }

    .row-title { font-weight: 600; }
    .row-meta { color: var(--muted); font-size: 12px; }

    .row-actions { display: inline-flex; gap: 8px; }

    /* History list with per-entry delete button */
    .history { list-style: none; padding: 0; margin: 0; }
    .history li { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; padding: 10px 12px; border: 1px dashed #e5e7eb; border-radius: 12px; background: #fff; }

    .history .btn-icon, .row-actions .btn-icon { width: 36px; height: 36px; border-radius: 12px; display: inline-flex; align-items: center; justify-content: center; }
    .btn-danger .icon, .btn-icon .icon { width: var(--icon-size); height: var(--icon-size); }

    .btn-danger { color: var(--danger); }
    .btn-complete { color: var(--success); border-color: #bbf7d0; }
    .btn-finish { color: var(--warning); border-color: #fde68a; }

    /* Hover tooltips for delete/complete/finish */
    .has-tooltip { position: relative; }
    .has-tooltip::after {
      content: attr(data-tooltip);
      position: absolute; left: 50%; bottom: calc(100% + 8px);
      transform: translateX(-50%);
      background: #111827; color: #fff; padding: 6px 8px; font-size: 12px; border-radius: 8px; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity .15s ease, transform .15s ease; transform-origin: bottom center; scale: .98;
    }
    .has-tooltip:hover::after { opacity: 1; scale: 1; }

    /* Utility */
    .muted { color: var(--muted); }
    .spacer { height: 24px; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sticky header -->
    <header class="tasklist-header panel" role="region" aria-label="Policy Task List header">
      <h1>Policy Task List</h1>
      <p class="subhead">Enter the names of the person completing each task and the verifier. Your entries are stored in your browser.</p>
      <div class="controls">
        <label for="filter"><span class="muted">Filter by periodicity:</span></label>
        <select id="filter" aria-label="Filter tasks by periodicity">
          <option value="All">All</option>
          <option value="Weekly">Weekly</option>
          <option value="Monthly">Monthly</option>
          <option value="Quarterly">Quarterly</option>
          <option value="Annually">Annually</option>
          <option value="Semi-Annually">Semi-Annually</option>
        </select>
        <button id="addTask" class="btn btn-primary has-tooltip" data-tooltip="Add a new task">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"/></svg>
          Add Task
        </button>
        <button id="undoBtn" class="btn btn-ghost has-tooltip" data-tooltip="Undo last change" aria-label="Undo">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 14l-5-5 5-5"/><path d="M20 20v-5a7 7 0 0 0-7-7H4"/></svg>
          Undo
        </button>
      </div>
    </header>

    <main class="stack">
      <section class="panel">
        <h2>Tasks</h2>
        <div id="taskList" class="stack" aria-live="polite"></div>
      </section>

      <section class="panel">
        <h2>History</h2>
        <p class="muted">Your last actions are stored locally. Use the trash icon to remove specific entries.</p>
        <ul id="historyList" class="history" aria-live="polite"></ul>
      </section>

      <div class="spacer"></div>
      <div class="spacer"></div>
    </main>
  </div>

  <script>
    // --- Minimal demo data & storage helpers ---
    const STORAGE_TASKS = 'policy_tasks_demo_v1';
    const STORAGE_HISTORY = 'policy_history_demo_v1';

    const load = (key, fallback) => {
      try { return JSON.parse(localStorage.getItem(key)) ?? fallback; } catch { return fallback; }
    };
    const save = (key, value) => localStorage.setItem(key, JSON.stringify(value));

    let tasks = load(STORAGE_TASKS, [
      { id: crypto.randomUUID(), title: 'Review access logs', periodicity: 'Weekly', assignee: '', verifier: '', done: false },
      { id: crypto.randomUUID(), title: 'Validate backups', periodicity: 'Monthly', assignee: '', verifier: '', done: false },
      { id: crypto.randomUUID(), title: 'Policy review meeting', periodicity: 'Quarterly', assignee: '', verifier: '', done: false },
    ]);

    let history = load(STORAGE_HISTORY, []);
    let undoStack = [];

    // --- Rendering ---
    const $taskList = document.getElementById('taskList');
    const $history = document.getElementById('historyList');

    function iconCheck() { return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"/></svg>'; }
    function iconFlag() { return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 3v18"/><path d="M4 5h11l-1.5 3L15 11H4"/></svg>'; }
    function iconTrash() { return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"/></svg>'; }

    function pushHistory(text) {
      history.unshift({ id: crypto.randomUUID(), text, ts: new Date().toISOString() });
      history = history.slice(0, 50); // keep last 50
      save(STORAGE_HISTORY, history);
      renderHistory();
    }

    function renderHistory() {
      $history.innerHTML = '';
      if (!history.length) {
        const li = document.createElement('li');
        li.innerHTML = '<span class="muted">No history yet.</span>';
        $history.appendChild(li);
        return;
      }
      history.forEach((h, idx) => {
        const li = document.createElement('li');
        const left = document.createElement('div');
        left.innerHTML = `<strong>${h.text}</strong><div class="muted" style="font-size:12px">${new Date(h.ts).toLocaleString()}</div>`;
        const right = document.createElement('div');
        right.innerHTML = `<button class="btn btn-icon btn-danger has-tooltip" data-tooltip="Delete this history entry" aria-label="Delete history entry" data-id="${h.id}">${iconTrash()}</button>`;
        li.appendChild(left); li.appendChild(right);
        $history.appendChild(li);
      });
    }

    function renderTasks() {
      const filterVal = document.getElementById('filter').value;
      $taskList.innerHTML = '';
      tasks
        .filter(t => filterVal === 'All' ? true : t.periodicity === filterVal)
        .forEach(t => {
          const row = document.createElement('div');
          row.className = 'row';
          row.setAttribute('data-id', t.id);
          if (t.done) row.setAttribute('aria-disabled','true');

          const left = document.createElement('div');
          left.innerHTML = `
            <div class="row-title">${t.title} <span class="muted">• ${t.periodicity}</span></div>
            <div class="row-meta">Assignee: <input type="text" value="${t.assignee}" placeholder="Name" aria-label="Assignee" style="margin-right:8px"> Verifier: <input type="text" value="${t.verifier}" placeholder="Name" aria-label="Verifier"></div>
          `;
          const right = document.createElement('div');
          right.className = 'row-actions';
          right.innerHTML = `
            <button class="btn btn-icon btn-complete has-tooltip" data-tooltip="Mark complete" aria-label="Complete task" data-action="complete">${iconCheck()}</button>
            <button class="btn btn-icon btn-finish has-tooltip" data-tooltip="Mark finished & archive" aria-label="Finish task" data-action="finish">${iconFlag()}</button>
            <button class="btn btn-icon btn-danger has-tooltip" data-tooltip="Delete task" aria-label="Delete task" data-action="delete">${iconTrash()}</button>
          `;

          row.appendChild(left); row.appendChild(right);
          $taskList.appendChild(row);

          // Wire up input changes
          const [assigneeInput, verifierInput] = left.querySelectorAll('input');
          assigneeInput.addEventListener('change', (e) => updateTask(t.id, { assignee: e.target.value }));
          verifierInput.addEventListener('change', (e) => updateTask(t.id, { verifier: e.target.value }));

          right.querySelectorAll('button').forEach(btn => btn.addEventListener('click', (e) => onTaskAction(t.id, btn.dataset.action)));
        });
    }

    function updateTask(id, patch) {
      const prev = JSON.parse(JSON.stringify(tasks));
      undoStack.push(prev);
      tasks = tasks.map(t => t.id === id ? { ...t, ...patch } : t);
      save(STORAGE_TASKS, tasks);
      renderTasks();
    }

    function onTaskAction(id, action) {
      const task = tasks.find(t => t.id === id);
      if (!task) return;
      const prev = JSON.parse(JSON.stringify(tasks));
      undoStack.push(prev);

      if (action === 'delete') {
        if (confirm(`Delete “${task.title}”?`)) {
          tasks = tasks.filter(t => t.id !== id);
          pushHistory(`Deleted task: ${task.title}`);
        }
      } else if (action === 'complete') {
        tasks = tasks.map(t => t.id === id ? { ...t, done: true } : t);
        pushHistory(`Completed task: ${task.title}`);
      } else if (action === 'finish') {
        tasks = tasks.map(t => t.id === id ? { ...t, done: true } : t);
        pushHistory(`Finished task: ${task.title}`);
      }
      save(STORAGE_TASKS, tasks);
      renderTasks();
    }

    // Delete a single history entry (per-entry wipe)
    $history.addEventListener('click', (e) => {
      const btn = e.target.closest('button[data-id]');
      if (!btn) return;
      const id = btn.getAttribute('data-id');
      const entry = history.find(h => h.id === id);
      if (entry && confirm('Delete this history entry?')) {
        const prev = JSON.parse(JSON.stringify(history));
        undoStack.push({ history: prev, tasks: JSON.parse(JSON.stringify(tasks)) });
        history = history.filter(h => h.id !== id);
        save(STORAGE_HISTORY, history);
        renderHistory();
      }
    });

    // Controls
    document.getElementById('filter').addEventListener('change', renderTasks);
    document.getElementById('addTask').addEventListener('click', () => {
      const title = prompt('Task name');
      if (!title) return;
      const periodicity = prompt('Periodicity (Weekly, Monthly, Quarterly, Annually, Semi-Annually)', 'Monthly') || 'Monthly';
      const prev = JSON.parse(JSON.stringify(tasks));
      undoStack.push(prev);
      tasks.unshift({ id: crypto.randomUUID(), title, periodicity, assignee: '', verifier: '', done: false });
      save(STORAGE_TASKS, tasks);
      pushHistory(`Added task: ${title}`);
      renderTasks();
    });

    document.getElementById('undoBtn').addEventListener('click', () => {
      const last = undoStack.pop();
      if (!last) return;
      // Support undo for either task or history changes
      if (Array.isArray(last)) {
        tasks = last; save(STORAGE_TASKS, tasks); renderTasks();
      } else if (last && last.history) {
        history = last.history; tasks = last.tasks || tasks; save(STORAGE_HISTORY, history); save(STORAGE_TASKS, tasks); renderHistory(); renderTasks();
      }
    });

    // Initial paint
    renderTasks();
    renderHistory();
  </script>
</body>
</html>
